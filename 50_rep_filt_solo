#!/usr/bin/env lae
#> выводит только те строки, где домен есть в справочнике ( сравнивать домены 2-го ур )
#> вынесен сюда чтобы избавиться от повторного кода
#> USAGE: ... | 50_rep_filt_solo "$onlysolo" -lb="field1 field2 domain field4 ..."
#> Должно быть определено поле domain в опции -lb

use Dom;
my $onlysolo = shift; # если есть эта - то фильтровать "соловьем", если нет - ничего не делает, просто печатает поток.

my %conf = do "conf.txt" or die "conf!";
my @domains_3l = map qr/$_/, @{ $conf{ domains_3l } };
my %domains;

if ( $onlysolo ){
    # домены 2-го уровня из справочника:
    %domains = map { Dom::d2l( $_, { d3l=>\@domains_3l } )||"" , 1 } split( /\s+/, `cat ./site2category.txt | cut -f1` );
    $domains{""}=1; # пустые результаты приведения доменов пусть попадают в результат. 
    # - искать почему есть то, чего не должно быть легче, чем наоборот.
}

_{
    #>> печатает только строки, где получилось перевести в домен 2l
    if ( $onlysolo ){
	#>> в режиме "только соловей" - фильтрует домены справочником
	return if not $domains{ Dom::d2l( Domain(), { d3l=>\@domains_3l } ) };
    }
    #>> Выходной формат такой-же как входной.
    p @F;
}    